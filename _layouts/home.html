---
layout: default
---

{%- if page.title -%}
<h1 class="page-heading">{{ page.title }}</h1>
{%- endif -%}

<div class="nav-header">
  <div class="search-box">
    <i class="icon-search"></i>
    <input id="search-input" type="text" onkeyup="searchByString(this.value)"></input>
  </div>
</div>

{{ content }}

{%- if site.posts.size > 0 -%}
<ul class="posts" id="post-list">
  <li class="post-list-item">
    <h2>Loading posts ...</h2>
  </li>
</ul>

<ul class="posts" id="post-full-list" style="display: none;">
  {%- for post in site.posts -%}
  <li id="post{{ post.id | escape | replace: '/', '_' | replace: '.', '_' }}" class="post-list-item">
    {%- assign date_format = site.plainwhite.date_format | default: "%b %-d, %Y" -%}
    <a class="post-link" href="{{ post.url | relative_url }}">
      <h2 class="post-title">{{ post.title | escape }}</h2>
    </a>
    <div class="post-meta">
      <ul class="post-tags">
        {%- for tag in post.tags -%}
        <li>{{ tag }}</li>
        {%- endfor -%}
      </ul>
      <div class="post-date">{{ post.date | date: date_format }}</div>
    </div>
  </li>
  {%- endfor -%}
</ul>
{%- endif -%}


<script id="fuse-script" async src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.4.5/fuse.min.js"></script>

<script>
  "use strict";
  var dataList = [
    {% for post in site.posts %}
      {
        "id"        : "post{{ post.id | escape | replace: '/', '_' | replace: '.', '_' }}",
        "title"     : "{{ post.title | escape }}",
        "desc"      : "{{ post.desc | escape }}",
        "tags"      : "{{ post.tags | join: ', ' }}",
        "url"       : "{{ site.baseurl }}{{ post.url }}",
        "date"      : "{{ post.date }}"
      } {% unless forloop.last %},{% endunless %}
    {% endfor %}
  ];
  var searchByString;

  function getUrlVars() {
    var vars = [], hash;
    var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
    for (var i = 0; i < hashes.length; i++) {
      hash = hashes[i].split('=');
      vars.push(hash[0]);
      vars[hash[0]] = hash[1];
    }
    return vars;
  }

  var searchInput = document.querySelector('#search-input');
  searchInput.value = getUrlVars()['q'] || "";

  var script = document.querySelector('#fuse-script');
  script.addEventListener('load', function () {
    var fuse = new Fuse(dataList, {
      shouldSort: true,
      threshold: 0.6,
      location: 0,
      distance: 100,
      maxPatternLength: 32,
      keys: [
        "url",
        "title",
        "desc",
        "tags"
      ]
    });

    var postsList = document.querySelector('#post-list');
    var postsFullList = document.querySelector('#post-full-list');

    searchByString = function (searchString) {
      var visible_children = postsList.querySelectorAll(".post-list-item");
      for (var i = 0, length = visible_children.length; i < length; i++) {
        postsList.removeChild(visible_children[i]);
      }

      var results = searchString != "" && fuse.search(searchString) || dataList;
      var result_ids = results.map(v => v.id);

      for (var i = 0, length = result_ids.length; i < length; i++) {
        var postItem = postsFullList.querySelector('#' + result_ids[i]);
        postsList.innerHTML += postItem.outerHTML;
      }
    }

    searchByString(searchInput.value);
  });
</script>